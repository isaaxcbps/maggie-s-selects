<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo | Maggie's Selects</title>
    <style>
        :root { --primary: #1a1a1a; --accent: #d4af37; --bg: #f9f9f9; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; }
        
        /* Men√∫ Lateral */
        .sidebar { width: 250px; height: 100vh; background: var(--primary); color: white; position: fixed; padding: 20px; box-sizing: border-box; }
        .sidebar h2 { font-size: 1.2rem; color: var(--accent); text-align: center; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .nav-btn { width: 100%; padding: 12px; background: none; border: none; color: #ccc; text-align: left; cursor: pointer; font-size: 1rem; transition: 0.3s; border-radius: 5px; margin-bottom: 5px; }
        .nav-btn:hover, .nav-btn.active { background: #333; color: white; }

        /* √Årea de Contenido */
        .main-content { margin-left: 250px; padding: 40px; width: 100%; }
        .section { display: none; background: var(--white); padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .section.active { display: block; animation: fadeIn 0.4s; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Estilos de Formulario y Tabla */
        h1 { margin-top: 0; font-weight: 300; text-transform: uppercase; letter-spacing: 1px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 600px; }
        .full { grid-column: span 2; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn-save { background: var(--primary); color: white; border: none; padding: 15px; cursor: pointer; border-radius: 6px; font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f4f4f4; text-transform: uppercase; font-size: 0.8rem; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
        .badge-cat { background: #e3f2fd; color: #1976d2; }
        
        .actions { display: flex; gap: 10px; }
        .btn-edit { color: #2196F3; cursor: pointer; background: none; border: none; font-size: 1.2rem; }
        .btn-delete { color: #f44336; cursor: pointer; background: none; border: none; font-size: 1.2rem; }
        
        #status-msg { margin-top: 20px; padding: 10px; border-radius: 6px; display: none; text-align: center; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Maggie's Admin</h2>
        <button class="nav-btn active" onclick="showSection('sec-ver')">üìä Inventario Actual</button>
        <button class="nav-btn" onclick="showSection('sec-add')">‚ûï A√±adir Producto</button>
    </div>

    <div class="main-content">
        <div id="sec-ver" class="section active">
            <h1>Inventario General</h1>
            <p>Aqu√≠ puedes visualizar, editar y eliminar los art√≠culos de la tienda.</p>
            <table>
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Categor√≠a</th>
                        <th>Precio</th>
                        <th>Stock</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="lista-tabla">
                    </tbody>
            </table>
        </div>

        <div id="sec-add" class="section">
            <h1 id="form-title">A√±adir Nuevo Art√≠culo</h1>
            <form id="main-form">
                <input type="hidden" id="prod-id">
                <div class="form-grid">
                    <div class="form-group full"><label>Nombre del Producto</label><input type="text" id="nombre" required></div>
                    <div class="form-group"><label>Marca</label><input type="text" id="marca" required></div>
                    <div class="form-group"><label>Categor√≠a</label>
                        <select id="categoria"><option value="carteras">Carteras</option><option value="perfumes">Perfumes</option></select>
                    </div>
                    <div class="form-group"><label>Precio ($)</label><input type="number" id="precio" step="0.01" required></div>
                    <div class="form-group"><label>Stock</label><input type="number" id="stock" required></div>
                    <div class="form-group full" id="group-foto"><label>Foto</label><input type="file" id="fotoInput" accept="image/*"></div>
                    <div class="form-group full">
                        <button type="submit" class="btn-save" id="btn-submit">Guardar en Cat√°logo</button>
                        <button type="button" onclick="cancelarEdicion()" id="btn-cancel" style="display:none; background:#ccc; margin-top:10px;" class="btn-save">Cancelar</button>
                    </div>
                </div>
            </form>
            <div id="status-msg"></div>
        </div>
    </div>

    <script>
        const API_URL = 'https://api-maggies.nauc8778.workers.dev';
        let isEditing = false;

        // --- NAVEGACI√ìN ---
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
            if(id === 'sec-ver') cargarInventario();
        }

        // --- MOSTRAR (READ) ---
        async function cargarInventario() {
            const res = await fetch(API_URL);
            const data = await res.json();
            const body = document.getElementById('lista-tabla');
            body.innerHTML = '';
            data.forEach(p => {
                body.innerHTML += `
                    <tr>
                        <td><strong>${p.marca}</strong><br>${p.nombre}</td>
                        <td><span class="badge badge-cat">${p.categoria}</span></td>
                        <td>$${p.precio.toFixed(2)}</td>
                        <td>${p.stock}</td>
                        <td class="actions">
                            <button class="btn-edit" onclick="iniciarEdicion(${p.id}, '${p.nombre}', '${p.marca}', ${p.precio}, ${p.stock})">‚úé</button>
                            <button class="btn-delete" onclick="borrarProducto(${p.id})">üóë</button>
                        </td>
                    </tr>`;
            });
        }

        // --- ELIMINAR (DELETE) ---
        async function borrarProducto(id) {
            if (!confirm("¬øDeseas eliminar este producto permanentemente?")) return;
            await fetch(API_URL, { method: 'DELETE', body: JSON.stringify({ id }) });
            cargarInventario();
        }

        // --- PREPARAR ACTUALIZACI√ìN (UPDATE) ---
        function iniciarEdicion(id, nombre, marca, precio, stock) {
            isEditing = true;
            document.getElementById('prod-id').value = id;
            document.getElementById('nombre').value = nombre;
            document.getElementById('marca').value = marca;
            document.getElementById('precio').value = precio;
            document.getElementById('stock').value = stock;
            document.getElementById('group-foto').style.display = 'none'; // No se edita la foto para evitar errores
            document.getElementById('form-title').innerText = "Editando Art√≠culo";
            document.getElementById('btn-submit').innerText = "Actualizar Cambios";
            document.getElementById('btn-cancel').style.display = 'block';
            showSection('sec-add');
        }

        function cancelarEdicion() { location.reload(); }

        // --- CREAR Y ACTUALIZAR (POST / PUT) ---
        document.getElementById('main-form').onsubmit = async (e) => {
            e.preventDefault();
            const msg = document.getElementById('status-msg');
            msg.style.display = "block";
            msg.innerText = "‚è≥ Procesando...";

            const datos = {
                nombre: document.getElementById('nombre').value,
                marca: document.getElementById('marca').value,
                precio: parseFloat(document.getElementById('precio').value),
                stock: parseInt(document.getElementById('stock').value)
            };

            if (isEditing) {
                const id = document.getElementById('prod-id').value;
                await fetch(API_URL, { method: 'PUT', body: JSON.stringify({ id, ...datos }) });
                alert("Producto actualizado");
                location.reload();
            } else {
                const file = document.getElementById('fotoInput').files[0];
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = async () => {
                    const fullData = { 
                        ...datos, 
                        categoria: document.getElementById('categoria').value,
                        imagenNombre: file.name.replace(/\s+/g, '-').toLowerCase(),
                        imagenBase64: reader.result.split(',')[1]
                    };
                    await fetch(API_URL, { method: 'POST', body: JSON.stringify(fullData) });
                    alert("Producto agregado con √©xito");
                    location.reload();
                };
            }
        };

        // Carga inicial
        window.onload = cargarInventario;
    </script>
</body>
</html>
